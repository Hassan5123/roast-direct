(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{2843:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),o=r(2115),n=r(5695),s=r(3358),c=r(5374),l=r(3819),i=r(6874),d=r.n(i);function u(){let{items:e,removeFromCart:t,updateQuantity:r,getCartTotal:i}=(0,s._)(),{isAuthenticated:u,checkingAuth:m}=(0,c.A)(),h=(0,n.useRouter)(),[x,p]=(0,o.useState)({}),[g,b]=(0,o.useState)(!1),[f,v]=(0,o.useState)(!1),[w,y]=(0,o.useState)({}),[j,N]=(0,o.useState)(!1),[k,I]=(0,o.useState)("");(0,o.useEffect)(()=>{v(!0)},[]),(0,o.useEffect)(()=>{m||u||h.push("/login")},[u,m,h]),(0,o.useEffect)(()=>{(async()=>{if(e.length>0&&u&&!m){N(!0),I("");try{let t=[...new Set(e.map(e=>e.productId))],r={};await Promise.all(t.map(async e=>{let t=await fetch("".concat("http://localhost:5002","/api/products/").concat(e));if(!t.ok)throw Error("Failed to fetch product ".concat(e));let a=await t.json();r[e]=a.product})),y(r);let a={};e.forEach(e=>{let t=r[e.productId];t&&e.quantity>t.inventory_count&&(a[e.productId]="Only ".concat(t.inventory_count," available in stock"))}),p(a)}catch(e){console.error("Error fetching product data:",e),I("Failed to fetch product data. Some inventory limits may not be accurate.")}finally{N(!1)}}})()},[e,u,m]);let C=(e,t,a)=>{if(a<1)return void p({...x,["".concat(e,"-").concat(t)]:"Quantity must be at least 1"});let o=w[e];if(o&&a>o.inventory_count)return void p({...x,["".concat(e,"-").concat(t)]:"Only ".concat(o.inventory_count," available in stock")});if(r(e,t,a)){let r={...x};delete r["".concat(e,"-").concat(t)],p(r)}},S=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e);return!f||m?(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,a.jsxs)("div",{className:"animate-pulse flex flex-col items-center p-12",children:[(0,a.jsx)("div",{className:"rounded-full bg-amber-200 h-12 w-12 mb-4"}),(0,a.jsx)("div",{className:"text-amber-800",children:"Loading cart..."})]})}):0===e.length?(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,a.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-8 text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-amber-900 mb-6",children:"Your Cart"}),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-amber-300 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"})}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Your cart is empty"}),(0,a.jsx)(d(),{href:"/products",className:"bg-amber-700 text-white px-6 py-2 rounded-md hover:bg-amber-800 transition-colors duration-300",children:"Browse Products"})]})]})}):(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,a.jsxs)("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-amber-900 mb-6",children:"Your Cart"}),k&&(0,a.jsx)("div",{className:"bg-amber-50 border border-amber-200 text-amber-800 p-3 rounded mb-4",children:(0,a.jsxs)("p",{className:"flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),k]})}),(0,a.jsx)("div",{className:"space-y-6",children:e.map(e=>{var r;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row border-b border-gray-200 pb-6",children:[(0,a.jsx)("div",{className:"md:w-1/6 h-24 bg-amber-100 rounded-md overflow-hidden",children:(0,a.jsx)("img",{src:(0,l.a)(e.productId),alt:e.name,className:"h-full w-full object-cover",onError:e=>{e.currentTarget.onerror=null;let t=window.location.origin;e.currentTarget.src="".concat(t,"/web-images/file.svg")}})}),(0,a.jsxs)("div",{className:"md:w-3/6 md:px-4 mt-4 md:mt-0",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-amber-900",children:e.name}),(0,a.jsxs)("p",{className:"text-gray-600 text-sm",children:["Grind: ",(0,a.jsx)("span",{className:"font-medium",children:e.grindOption})]}),(0,a.jsxs)("p",{className:"text-amber-700 mt-1",children:[S(e.price)," each"]})]}),(0,a.jsxs)("div",{className:"md:w-1/6 flex items-center mt-4 md:mt-0 md:justify-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>C(e.productId,e.grindOption,e.quantity-1),className:"p-1 border border-gray-300 rounded-l-md hover:bg-gray-100 text-black",disabled:j,children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),(0,a.jsx)("input",{type:"number",min:"1",max:(null==(r=w[e.productId])?void 0:r.inventory_count)||999,value:e.quantity,onChange:t=>C(e.productId,e.grindOption,parseInt(t.target.value)||1),className:"w-12 text-center border-t border-b border-gray-300 p-1 text-black ".concat(x[e.productId]?"border-red-300":""),disabled:j}),(0,a.jsx)("button",{onClick:()=>C(e.productId,e.grindOption,e.quantity+1),className:"p-1 border border-gray-300 rounded-r-md hover:bg-gray-100 text-black",disabled:j||w[e.productId]&&e.quantity>=w[e.productId].inventory_count,children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),x["".concat(e.productId,"-").concat(e.grindOption)]&&(0,a.jsx)("p",{className:"text-xs text-red-600 mt-1",children:x["".concat(e.productId,"-").concat(e.grindOption)]}),w[e.productId]&&!x[e.productId]&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["In stock: ",w[e.productId].inventory_count]})]}),(0,a.jsxs)("div",{className:"md:w-1/6 flex items-center justify-between md:justify-end mt-4 md:mt-0",children:[(0,a.jsx)("span",{className:"text-amber-800 font-medium",children:S(e.price*e.quantity)}),(0,a.jsx)("button",{onClick:()=>{t(e.productId,e.grindOption)},className:"text-red-500 hover:text-red-700 ml-4","aria-label":"Remove item",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},"".concat(e.productId,"-").concat(e.grindOption))})}),(0,a.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Order Summary"}),(0,a.jsx)("span",{className:"text-xl font-bold text-amber-900",children:S(i())})]}),(0,a.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,a.jsx)(d(),{href:"/products",className:"block text-center bg-white border border-amber-700 text-amber-700 px-6 py-2 rounded-md hover:bg-amber-50 transition-colors duration-300",children:"Continue Shopping"}),(0,a.jsx)("button",{onClick:()=>{b(!0),h.push("/checkout")},disabled:g||0===e.length,className:"w-full ".concat(g?"bg-amber-500":"bg-amber-700"," text-white py-3 px-6 rounded-md hover:bg-amber-800 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 transition-colors duration-300 flex items-center justify-center"),children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin h-5 w-5 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Proceed to Checkout"})]})]})]})})}},3358:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>c,_:()=>s});var a=r(5155),o=r(2115);let n=(0,o.createContext)(void 0);function s(){let e=(0,o.useContext)(n);if(!e)throw Error("useCart must be used within a CartProvider");return e}function c(e){let{children:t}=e,[r,s]=(0,o.useState)([]);return(0,o.useEffect)(()=>{try{let e=localStorage.getItem("roastDirectCart");e&&s(JSON.parse(e))}catch(e){console.error("Failed to load cart from localStorage:",e)}},[]),(0,o.useEffect)(()=>{try{localStorage.setItem("roastDirectCart",JSON.stringify(r))}catch(e){console.error("Failed to save cart to localStorage:",e)}},[r]),(0,a.jsx)(n.Provider,{value:{items:r,addToCart:e=>{s(t=>{let r=t.findIndex(t=>t.productId===e.productId&&t.grindOption===e.grindOption);if(!(r>-1))return[...t,e];{let a=[...t];return a[r]={...a[r],quantity:e.quantity},a}})},removeFromCart:(e,t)=>{s(r=>r.filter(r=>r.productId!==e||r.grindOption!==t))},updateQuantity:(e,t,r)=>!(r<1)&&(s(a=>a.map(a=>a.productId===e&&a.grindOption===t?{...a,quantity:r}:a)),!0),clearCart:()=>{s([])},getCartTotal:()=>r.reduce((e,t)=>e+t.price*t.quantity,0),getItemCount:()=>r.reduce((e,t)=>e+t.quantity,0)},children:t})}},3819:(e,t,r)=>{"use strict";r.d(t,{U:()=>o,a:()=>a});let a=e=>{let t=window.location.origin;return"".concat(t,"/web-images/product-images/").concat(e,".jpg")},o=(e,t)=>{let r=[".webp",".jpeg",".png"],a=e.currentTarget,o=window.location.origin,n=parseInt(a.getAttribute("data-attempt")||"0",10);if(n<r.length)a.setAttribute("data-attempt",(n+1).toString()),a.src="".concat(o,"/web-images/product-images/").concat(t).concat(r[n]);else if(a.onerror=null,a.style.display="none",a.parentElement){a.parentElement.classList.add("flex","items-center","justify-center");let e=document.createElement("span");e.className="text-amber-700",e.textContent="No image available",a.parentElement.appendChild(e)}}},5374:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>l});var a=r(5155),o=r(2115),n=r(5695);let s=(0,o.createContext)(void 0);function c(){let e=(0,o.useContext)(s);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[r,c]=(0,o.useState)(!1),[l,i]=(0,o.useState)(!0),[d,u]=(0,o.useState)(null),m=(0,n.useRouter)(),h=(0,n.usePathname)();(0,o.useEffect)(()=>{let e=()=>{try{let e=localStorage.getItem("roastDirectAuth");c("true"===e);let t=localStorage.getItem("userData");t?u(JSON.parse(t)):u(null)}catch(e){console.error("Failed to check auth status:",e),c(!1),u(null)}finally{i(!1)}};e();let t=t=>{"roastDirectAuth"===t.key&&e()};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}},[]),(0,o.useEffect)(()=>{l||r||["/cart"].some(e=>h.startsWith(e))&&m.push("/login")},[r,l,h,m]);let x=async(e,t)=>{try{let r=await fetch("".concat("http://localhost:5002","/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok)return!1;let a=await r.json();return localStorage.setItem("roastDirectAuth","true"),localStorage.setItem("authToken",a.token),localStorage.setItem("userData",JSON.stringify(a.user)),c(!0),u(a.user),!0}catch(e){return console.error("Login error:",e),!1}};return(0,a.jsx)(s.Provider,{value:{isAuthenticated:r,login:x,logout:()=>{localStorage.removeItem("roastDirectAuth"),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),c(!1),u(null),m.push("/login")},checkingAuth:l,user:d},children:t})}},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},8379:(e,t,r)=>{Promise.resolve().then(r.bind(r,2843))}},e=>{e.O(0,[874,441,964,358],()=>e(e.s=8379)),_N_E=e.O()}]);