(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[975],{3358:(e,t,r)=>{"use strict";r.d(t,{CartProvider:()=>n,_:()=>i});var a=r(5155),s=r(2115);let o=(0,s.createContext)(void 0);function i(){let e=(0,s.useContext)(o);if(!e)throw Error("useCart must be used within a CartProvider");return e}function n(e){let{children:t}=e,[r,i]=(0,s.useState)([]);return(0,s.useEffect)(()=>{try{let e=localStorage.getItem("roastDirectCart");e&&i(JSON.parse(e))}catch(e){console.error("Failed to load cart from localStorage:",e)}},[]),(0,s.useEffect)(()=>{try{localStorage.setItem("roastDirectCart",JSON.stringify(r))}catch(e){console.error("Failed to save cart to localStorage:",e)}},[r]),(0,a.jsx)(o.Provider,{value:{items:r,addToCart:e=>{i(t=>{let r=t.findIndex(t=>t.productId===e.productId&&t.grindOption===e.grindOption);if(!(r>-1))return[...t,e];{let a=[...t];return a[r]={...a[r],quantity:e.quantity},a}})},removeFromCart:(e,t)=>{i(r=>r.filter(r=>r.productId!==e||r.grindOption!==t))},updateQuantity:(e,t,r)=>!(r<1)&&(i(a=>a.map(a=>a.productId===e&&a.grindOption===t?{...a,quantity:r}:a)),!0),clearCart:()=>{i([])},getCartTotal:()=>r.reduce((e,t)=>e+t.price*t.quantity,0),getItemCount:()=>r.reduce((e,t)=>e+t.quantity,0)},children:t})}},4973:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(5155),s=r(2115),o=r(5695),i=r(3358),n=r(5374);function l(){let{items:e,getCartTotal:t,clearCart:r}=(0,i._)(),{isAuthenticated:l,checkingAuth:c,user:d}=(0,n.A)(),u=(0,o.useRouter)(),[m,h]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(""),[b,j]=(0,s.useState)(""),[v,y]=(0,s.useState)(null),w="http://localhost:5002";(0,s.useEffect)(()=>{h(!0)},[]),(0,s.useEffect)(()=>{c||l||u.push("/login")},[l,c,u]),(0,s.useEffect)(()=>{m&&0===e.length&&u.push("/cart")},[m,e,u]),(0,s.useEffect)(()=>{m&&e.length>0&&N()},[m,e]);let N=async()=>{try{x(!0),f("");let e=localStorage.getItem("checkoutFormData");if(!e)return void u.push("/checkout");let r=JSON.parse(e),a=t(),s={street:r.shippingAddress,city:r.shippingCity,state:r.shippingState,zip:r.shippingZip},o=r.sameAsShipping?s:{street:r.billingAddress,city:r.billingCity,state:r.billingState,zip:r.billingZip};new Date().getFullYear();let i=parseInt(r.expYear);i<100&&(i=2e3+i);let n=await fetch("".concat(w,"/api/orders/final_total"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({subtotal:a,card_number:r.cardNumber.replace(/\s+/g,""),cardholder_name:r.cardholderName,cvc:r.cvc,exp_month:parseInt(r.expMonth),exp_year:i,shipping_address:s,billing_address:o})});if(!n.ok){let e=await n.json(),t=Error(e.error||"Failed to calculate order totals");throw e.details&&(t.details=e.details),t}let l=await n.json();y(l)}catch(r){console.error("Error calculating order totals:",r);let t="Failed to calculate order totals. Please try again.";if(r.message){var e;t=(null==(e=r.details)?void 0:e.message)||t}r instanceof Error&&r.details&&(t="".concat(t," (").concat(r.details.join(", "),")")),f(t)}finally{x(!1)}},S=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e),k=async()=>{try{x(!0),f("");let t=localStorage.getItem("checkoutFormData");if(!t||!v)return void f("Missing order information. Please go back to checkout.");let a=JSON.parse(t),s={street:a.shippingAddress,city:a.shippingCity,state:a.shippingState,zip:a.shippingZip},o=e.map(e=>({product_id:e.productId,quantity:e.quantity,price_at_time:e.price,grind_option:e.grindOption||"Whole Bean"})),i=await fetch("".concat(w,"/api/orders/place_order"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({items:o,shipping_address:s,final_total:v.final_total})});if(!i.ok){let e=await i.json();throw Error(e.error||"Failed to place order")}await i.json(),r(),localStorage.removeItem("checkoutFormData"),f(""),j("Order placed successfully! Redirecting to orders page..."),setTimeout(()=>{u.push("/orders")},1e3)}catch(e){console.error("Error placing order:",e),f(e.message||"Failed to place order. Please try again.")}finally{x(!1)}},C=()=>{u.push("/checkout")};return b?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md max-w-md w-full text-center",children:[(0,a.jsx)("div",{className:"text-green-500 mb-4",children:(0,a.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Order Placed!"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:b}),(0,a.jsx)("div",{className:"animate-pulse flex justify-center",children:(0,a.jsx)("div",{className:"h-2 w-16 bg-amber-600 rounded"})})]})}):!m||c||p?(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,a.jsxs)("div",{className:"animate-pulse flex flex-col items-center p-12",children:[(0,a.jsx)("div",{className:"rounded-full bg-amber-200 h-12 w-12 mb-4"}),(0,a.jsx)("div",{className:"text-amber-800",children:"Processing your order..."})]})}):g?(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,a.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-amber-900 mb-6",children:"Review Order"}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-md mb-6",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,a.jsx)("span",{children:g})]})}),(0,a.jsx)("div",{className:"mt-6 flex justify-center",children:(0,a.jsx)("button",{onClick:C,className:"bg-amber-600 text-white py-2 px-6 rounded-md hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 transition-colors duration-300",children:"Back to Checkout"})})]})}):(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,a.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-amber-900 mb-6",children:"Review Order"}),(0,a.jsx)("div",{className:"border border-gray-200 rounded-md divide-y divide-gray-200 mb-6",children:e.map(e=>(0,a.jsxs)("div",{className:"p-4 flex items-start",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-amber-100 rounded-md overflow-hidden mr-4",children:(0,a.jsx)("img",{src:e.imageUrl,alt:e.name,className:"h-full w-full object-cover",onError:e=>{e.currentTarget.onerror=null,e.currentTarget.src="/web-images/file.svg"}})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-medium text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-gray-500 text-sm",children:["Grind: ",e.grindOption]}),(0,a.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-700",children:[e.quantity," x ",S(e.price)]}),(0,a.jsx)("span",{className:"font-medium text-amber-800",children:S(e.price*e.quantity)})]})]})]},"".concat(e.productId,"-").concat(e.grindOption)))}),(0,a.jsxs)("div",{className:"bg-amber-50 p-6 rounded-md border border-amber-100 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-amber-900 mb-4",children:"Order Summary"}),(0,a.jsxs)("div",{className:"space-y-2 text-gray-700",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Subtotal"}),(0,a.jsx)("span",{children:v?S(v.subtotal):S(t())})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:["Tax (",v?"".concat(v.tax_rate,"%"):"?%",")"]}),(0,a.jsx)("span",{children:v?S(v.tax_amount):"-"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Shipping"}),(0,a.jsx)("span",{children:v?S(v.shipping_cost):"-"})]}),(0,a.jsxs)("div",{className:"border-t border-amber-200 pt-2 mt-2 flex justify-between font-bold text-amber-900",children:[(0,a.jsx)("span",{children:"Total"}),(0,a.jsx)("span",{children:v?S(v.final_total):"-"})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between gap-4",children:[(0,a.jsx)("button",{onClick:C,className:"md:w-1/2 bg-white border border-amber-700 text-amber-700 py-3 px-6 rounded-md hover:bg-amber-50 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 transition-colors duration-300",children:"Back to Checkout"}),(0,a.jsx)("button",{onClick:k,className:"md:w-1/2 bg-amber-700 text-white py-3 px-6 rounded-md hover:bg-amber-800 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 transition-colors duration-300",children:"Place Order"})]})]})})}},5374:(e,t,r)=>{"use strict";r.d(t,{A:()=>n,AuthProvider:()=>l});var a=r(5155),s=r(2115),o=r(5695);let i=(0,s.createContext)(void 0);function n(){let e=(0,s.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function l(e){let{children:t}=e,[r,n]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null),m=(0,o.useRouter)(),h=(0,o.usePathname)();(0,s.useEffect)(()=>{let e=()=>{try{let e=localStorage.getItem("roastDirectAuth");n("true"===e);let t=localStorage.getItem("userData");t?u(JSON.parse(t)):u(null)}catch(e){console.error("Failed to check auth status:",e),n(!1),u(null)}finally{c(!1)}};e();let t=t=>{"roastDirectAuth"===t.key&&e()};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}},[]),(0,s.useEffect)(()=>{l||r||["/cart"].some(e=>h.startsWith(e))&&m.push("/login")},[r,l,h,m]);let p=async(e,t)=>{try{let r=await fetch("".concat("http://localhost:5002","/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(!r.ok)return!1;let a=await r.json();return localStorage.setItem("roastDirectAuth","true"),localStorage.setItem("authToken",a.token),localStorage.setItem("userData",JSON.stringify(a.user)),n(!0),u(a.user),!0}catch(e){return console.error("Login error:",e),!1}};return(0,a.jsx)(i.Provider,{value:{isAuthenticated:r,login:p,logout:()=>{localStorage.removeItem("roastDirectAuth"),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),n(!1),u(null),m.push("/login")},checkingAuth:l,user:d},children:t})}},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},9381:(e,t,r)=>{Promise.resolve().then(r.bind(r,4973))}},e=>{e.O(0,[441,964,358],()=>e(e.s=9381)),_N_E=e.O()}]);