(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{2257:(e,r,t)=>{Promise.resolve().then(t.bind(t,9301))},3358:(e,r,t)=>{"use strict";t.d(r,{CartProvider:()=>n,_:()=>l});var i=t(5155),s=t(2115);let a=(0,s.createContext)(void 0);function l(){let e=(0,s.useContext)(a);if(!e)throw Error("useCart must be used within a CartProvider");return e}function n(e){let{children:r}=e,[t,l]=(0,s.useState)([]);return(0,s.useEffect)(()=>{try{let e=localStorage.getItem("roastDirectCart");e&&l(JSON.parse(e))}catch(e){console.error("Failed to load cart from localStorage:",e)}},[]),(0,s.useEffect)(()=>{try{localStorage.setItem("roastDirectCart",JSON.stringify(t))}catch(e){console.error("Failed to save cart to localStorage:",e)}},[t]),(0,i.jsx)(a.Provider,{value:{items:t,addToCart:e=>{l(r=>{let t=r.findIndex(r=>r.productId===e.productId&&r.grindOption===e.grindOption);if(!(t>-1))return[...r,e];{let i=[...r];return i[t]={...i[t],quantity:e.quantity},i}})},removeFromCart:(e,r)=>{l(t=>t.filter(t=>t.productId!==e||t.grindOption!==r))},updateQuantity:(e,r,t)=>!(t<1)&&(l(i=>i.map(i=>i.productId===e&&i.grindOption===r?{...i,quantity:t}:i)),!0),clearCart:()=>{l([])},getCartTotal:()=>t.reduce((e,r)=>e+r.price*r.quantity,0),getItemCount:()=>t.reduce((e,r)=>e+r.quantity,0)},children:r})}},5374:(e,r,t)=>{"use strict";t.d(r,{A:()=>n,AuthProvider:()=>d});var i=t(5155),s=t(2115),a=t(5695);let l=(0,s.createContext)(void 0);function n(){let e=(0,s.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function d(e){let{children:r}=e,[t,n]=(0,s.useState)(!1),[d,o]=(0,s.useState)(!0),[c,m]=(0,s.useState)(null),u=(0,a.useRouter)(),p=(0,a.usePathname)();(0,s.useEffect)(()=>{let e=()=>{try{let e=localStorage.getItem("roastDirectAuth");n("true"===e);let r=localStorage.getItem("userData");r?m(JSON.parse(r)):m(null)}catch(e){console.error("Failed to check auth status:",e),n(!1),m(null)}finally{o(!1)}};e();let r=r=>{"roastDirectAuth"===r.key&&e()};return window.addEventListener("storage",r),()=>{window.removeEventListener("storage",r)}},[]),(0,s.useEffect)(()=>{d||t||["/cart"].some(e=>p.startsWith(e))&&u.push("/login")},[t,d,p,u]);let h=async(e,r)=>{try{let t=await fetch("".concat("http://localhost:5002","/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})});if(!t.ok)return!1;let i=await t.json();return localStorage.setItem("roastDirectAuth","true"),localStorage.setItem("authToken",i.token),localStorage.setItem("userData",JSON.stringify(i.user)),n(!0),m(i.user),!0}catch(e){return console.error("Login error:",e),!1}};return(0,i.jsx)(l.Provider,{value:{isAuthenticated:t,login:h,logout:()=>{localStorage.removeItem("roastDirectAuth"),localStorage.removeItem("authToken"),localStorage.removeItem("userData"),n(!1),m(null),u.push("/login")},checkingAuth:d,user:c},children:r})}},5695:(e,r,t)=>{"use strict";var i=t(8999);t.o(i,"useParams")&&t.d(r,{useParams:function(){return i.useParams}}),t.o(i,"usePathname")&&t.d(r,{usePathname:function(){return i.usePathname}}),t.o(i,"useRouter")&&t.d(r,{useRouter:function(){return i.useRouter}})},9301:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>d});var i=t(5155),s=t(2115),a=t(5695),l=t(3358),n=t(5374);function d(){let{items:e,getCartTotal:r,clearCart:t}=(0,l._)(),{isAuthenticated:d,checkingAuth:o,user:c}=(0,n.A)(),m=(0,a.useRouter)(),[u,p]=(0,s.useState)(!1),[h,g]=(0,s.useState)(!1),[b,x]=(0,s.useState)(0),[f,N]=(0,s.useState)(""),[y,j]=(0,s.useState)({cardNumber:"",cardholderName:"",cvc:"",expMonth:"",expYear:"",shippingAddress:"",shippingCity:"",shippingState:"",shippingZip:"",phone:"",sameAsShipping:!0,billingName:"",billingAddress:"",billingCity:"",billingState:"",billingZip:""}),[v,S]=(0,s.useState)({});(0,s.useEffect)(()=>{p(!0),C()},[]),(0,s.useEffect)(()=>{o||d||m.push("/login")},[d,o,m]),(0,s.useEffect)(()=>{u&&0===e.length&&m.push("/cart")},[u,e,m]);let C=async()=>{try{let t=await fetch("".concat("http://localhost:5002","/api/orders/subtotal"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("authToken"))},body:JSON.stringify({items:e.map(e=>({product_id:e.productId,quantity:e.quantity,price:e.price,grind_option:e.grindOption||"Whole Bean"}))})});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to fetch subtotal")}let i=await t.json();x(i.subtotal||r())}catch(e){console.error("Error fetching subtotal:",e),x(r())}},w=e=>{let{name:r,value:t,type:i}=e.target,s="checkbox"===i?e.target.checked:t;j(e=>({...e,[r]:s})),"sameAsShipping"===r&&!0===s&&j(e=>({...e,billingName:y.cardholderName,billingAddress:e.shippingAddress,billingCity:e.shippingCity,billingState:e.shippingState,billingZip:e.shippingZip})),v[r]&&S(e=>{let t={...e};return delete t[r],t})},k=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e);return!u||o?(0,i.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,i.jsxs)("div",{className:"animate-pulse flex flex-col items-center p-12",children:[(0,i.jsx)("div",{className:"rounded-full bg-amber-200 h-12 w-12 mb-4"}),(0,i.jsx)("div",{className:"text-amber-800",children:"Loading checkout..."})]})}):(0,i.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-amber-50",children:(0,i.jsxs)("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-amber-900 mb-6",children:"Checkout"}),f&&(0,i.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-md mb-6",children:(0,i.jsxs)("div",{className:"flex",children:[(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,i.jsx)("span",{children:f})]})}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-xl font-semibold text-amber-900 mb-4",children:"Order Summary"}),(0,i.jsx)("div",{className:"border border-gray-200 rounded-md divide-y divide-gray-200",children:e.map(e=>(0,i.jsxs)("div",{className:"p-4 flex items-start",children:[(0,i.jsx)("div",{className:"w-16 h-16 bg-amber-100 rounded-md overflow-hidden mr-4",children:(0,i.jsx)("img",{src:e.imageUrl,alt:e.name,className:"h-full w-full object-cover",onError:e=>{e.currentTarget.onerror=null,e.currentTarget.src="/web-images/file.svg"}})}),(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("h3",{className:"font-medium text-gray-800",children:e.name}),(0,i.jsxs)("p",{className:"text-gray-500 text-sm",children:["Grind: ",e.grindOption]}),(0,i.jsxs)("div",{className:"flex justify-between mt-2",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-700",children:[e.quantity," x ",k(e.price)]}),(0,i.jsx)("span",{className:"font-medium text-amber-800",children:k(e.price*e.quantity)})]})]})]},"".concat(e.productId,"-").concat(e.grindOption)))}),(0,i.jsxs)("div",{className:"mt-4 border-t border-gray-200 pt-4 flex justify-between items-center",children:[(0,i.jsx)("span",{className:"text-lg font-medium text-gray-800",children:"Subtotal"}),(0,i.jsx)("span",{className:"text-xl font-bold text-amber-900",children:k(b)})]})]}),(0,i.jsx)("div",{children:(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),S({}),N("");let r={};if(y.cardNumber.trim()||(r.cardNumber="Card number is required"),y.cardholderName.trim()||(r.cardholderName="Cardholder name is required"),y.cvc.trim()||(r.cvc="CVC is required"),y.expMonth.trim()||(r.expMonth="Expiration month is required"),y.expYear.trim()||(r.expYear="Expiration year is required"),y.shippingAddress.trim()||(r.shippingAddress="Shipping address is required"),y.shippingCity.trim()||(r.shippingCity="City is required"),y.shippingState.trim()||(r.shippingState="State is required"),y.shippingZip.trim()||(r.shippingZip="ZIP code is required"),y.phone.trim()||(r.phone="Phone number is required"),!y.sameAsShipping&&(y.billingName.trim()||(r.billingName="Billing name is required"),y.billingAddress.trim()||(r.billingAddress="Billing address is required"),y.billingCity.trim()||(r.billingCity="Billing city is required"),y.billingState.trim()||(r.billingState="Billing state is required"),y.billingZip.trim()||(r.billingZip="Billing ZIP code is required")),Object.keys(r).length>0)return void S(r);localStorage.setItem("checkoutFormData",JSON.stringify(y)),m.push("/review")},className:"space-y-6",children:[(0,i.jsxs)("div",{className:"bg-amber-50 p-4 rounded-md border border-amber-200",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-amber-900 mb-4",children:"Card Details"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"cardNumber",className:"block text-sm font-medium text-gray-700 mb-1",children:"Card Number"}),(0,i.jsx)("input",{type:"text",id:"cardNumber",name:"cardNumber",value:y.cardNumber,onChange:w,className:"w-full p-2 border ".concat(v.cardNumber?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black"),placeholder:"•••• •••• •••• ••••",maxLength:19}),v.cardNumber&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.cardNumber})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"cardholderName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Cardholder Name"}),(0,i.jsx)("input",{type:"text",id:"cardholderName",name:"cardholderName",value:y.cardholderName,onChange:w,className:"w-full p-2 border ".concat(v.cardholderName?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.cardholderName&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.cardholderName})]}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"col-span-1",children:[(0,i.jsx)("label",{htmlFor:"expMonth",className:"block text-sm font-medium text-gray-700 mb-1",children:"Month"}),(0,i.jsxs)("select",{id:"expMonth",name:"expMonth",value:y.expMonth,onChange:w,className:"w-full p-2 border ".concat(v.expMonth?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black"),children:[(0,i.jsx)("option",{value:"",children:"MM"}),Array.from({length:12},(e,r)=>r+1).map(e=>(0,i.jsx)("option",{value:e.toString().padStart(2,"0"),children:e.toString().padStart(2,"0")},e))]}),v.expMonth&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.expMonth})]}),(0,i.jsxs)("div",{className:"col-span-1",children:[(0,i.jsx)("label",{htmlFor:"expYear",className:"block text-sm font-medium text-gray-700 mb-1",children:"Year"}),(0,i.jsxs)("select",{id:"expYear",name:"expYear",value:y.expYear,onChange:w,className:"w-full p-2 border ".concat(v.expYear?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black"),children:[(0,i.jsx)("option",{value:"",children:"YY"}),Array.from({length:10},(e,r)=>new Date().getFullYear()+r).map(e=>(0,i.jsx)("option",{value:e.toString().slice(-2),children:e.toString().slice(-2)},e))]}),v.expYear&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.expYear})]}),(0,i.jsxs)("div",{className:"col-span-1",children:[(0,i.jsx)("label",{htmlFor:"cvc",className:"block text-sm font-medium text-gray-700 mb-1",children:"CVC"}),(0,i.jsx)("input",{type:"text",id:"cvc",name:"cvc",value:y.cvc,onChange:w,className:"w-full p-2 border ".concat(v.cvc?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black"),placeholder:"•••",maxLength:4}),v.cvc&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.cvc})]})]})]})]}),(0,i.jsxs)("div",{className:"bg-amber-50 p-4 rounded-md border border-amber-200",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-amber-900 mb-4",children:"Shipping Address"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"shippingAddress",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),(0,i.jsx)("input",{type:"text",id:"shippingAddress",name:"shippingAddress",value:y.shippingAddress,onChange:w,className:"w-full p-2 border ".concat(v.shippingAddress?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.shippingAddress&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.shippingAddress})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"shippingCity",className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),(0,i.jsx)("input",{type:"text",id:"shippingCity",name:"shippingCity",value:y.shippingCity,onChange:w,className:"w-full p-2 border ".concat(v.shippingCity?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.shippingCity&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.shippingCity})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"shippingState",className:"block text-sm font-medium text-gray-700 mb-1",children:"State"}),(0,i.jsx)("input",{type:"text",id:"shippingState",name:"shippingState",value:y.shippingState,onChange:w,placeholder:"Enter state",className:"w-full p-2 border ".concat(v.shippingState?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.shippingState&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.shippingState})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"shippingZip",className:"block text-sm font-medium text-gray-700 mb-1",children:"ZIP Code"}),(0,i.jsx)("input",{type:"text",id:"shippingZip",name:"shippingZip",value:y.shippingZip,onChange:w,className:"w-full p-2 border ".concat(v.shippingZip?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.shippingZip&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.shippingZip})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),(0,i.jsx)("input",{type:"tel",id:"phone",name:"phone",value:y.phone,onChange:w,className:"w-full p-2 border ".concat(v.phone?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.phone&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.phone})]})]})]})]}),(0,i.jsxs)("div",{className:"bg-amber-50 p-4 rounded-md border border-amber-200",children:[(0,i.jsxs)("div",{className:"flex items-center mb-4",children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-amber-900",children:"Billing Address"}),(0,i.jsxs)("div",{className:"ml-auto flex items-center",children:[(0,i.jsx)("input",{type:"checkbox",id:"sameAsShipping",name:"sameAsShipping",checked:y.sameAsShipping,onChange:w,className:"h-4 w-4 text-amber-600 border-gray-300 rounded"}),(0,i.jsx)("label",{htmlFor:"sameAsShipping",className:"ml-2 text-sm text-gray-700",children:"Same as shipping"})]})]}),!y.sameAsShipping&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"billingName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name"}),(0,i.jsx)("input",{type:"text",id:"billingName",name:"billingName",value:y.billingName,onChange:w,className:"w-full p-2 border ".concat(v.billingName?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.billingName&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.billingName})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"billingAddress",className:"block text-sm font-medium text-gray-700 mb-1",children:"Address"}),(0,i.jsx)("input",{type:"text",id:"billingAddress",name:"billingAddress",value:y.billingAddress,onChange:w,className:"w-full p-2 border ".concat(v.billingAddress?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.billingAddress&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.billingAddress})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"billingCity",className:"block text-sm font-medium text-gray-700 mb-1",children:"City"}),(0,i.jsx)("input",{type:"text",id:"billingCity",name:"billingCity",value:y.billingCity,onChange:w,className:"w-full p-2 border ".concat(v.billingCity?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.billingCity&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.billingCity})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"billingState",className:"block text-sm font-medium text-gray-700 mb-1",children:"State"}),(0,i.jsx)("input",{type:"text",id:"billingState",name:"billingState",value:y.billingState,onChange:w,placeholder:"Enter state",className:"w-full p-2 border ".concat(v.billingState?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.billingState&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.billingState})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{htmlFor:"billingZip",className:"block text-sm font-medium text-gray-700 mb-1",children:"ZIP Code"}),(0,i.jsx)("input",{type:"text",id:"billingZip",name:"billingZip",value:y.billingZip,onChange:w,className:"w-full p-2 border ".concat(v.billingZip?"border-red-500":"border-gray-300"," rounded-md focus:ring focus:ring-amber-200 focus:border-amber-500 outline-none text-black")}),v.billingZip&&(0,i.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.billingZip})]})]})]}),(0,i.jsxs)("div",{className:"pt-4 space-y-4",children:[(0,i.jsx)("button",{type:"button",onClick:()=>m.push("/cart"),className:"w-full bg-white border border-amber-700 text-amber-700 py-2 px-4 rounded-md hover:bg-amber-50 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 transition-colors duration-300",children:"Back to Cart"}),(0,i.jsx)("button",{type:"submit",className:"w-full bg-amber-700 text-white py-3 px-6 rounded-md hover:bg-amber-800 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2 transition-colors duration-300",children:"Review Order"})]})]})})]})]})})}}},e=>{e.O(0,[441,964,358],()=>e(e.s=2257)),_N_E=e.O()}]);